[
    {
        "level": "#",
        "title": "Control Designs For Critical-Continegency Responsible Grid-Following Inverters And Seamless Transitions To And From Grid-Forming Modes",
        "content": "\nJaesang Park1,a, Alireza Askarian1,b, and Srinivasa Salapaka1,c\n\n  Abstract\u2014 This article introduces two control frameworks:\none for Grid-Following (GFL) inverters aiding Grid-Forming\n(GFM) inverters in voltage regulation during large contingency\nevents and optimizing power transactions under normal con-\nditions; and another for seamless transitions between grid-tied\nand grid-isolated setups, managing voltage transient charac-\nteristics. In microgrids, GFM inverters regulate voltage, while\nGFL inverters handle power transactions. The proposed GFL\ncontrol detects abrupt load/generation changes, adjusting power\ntransactions using local storage to support GFM inverters\nduring contingencies. Additionally, a transition control ensures\nsmooth GFL-GFM shifts, reducing power and voltage fluctua-\ntions. Simulation results validate improved voltage regulation\nduring contingencies and enhanced power tracking during slow\nchanges, alongside minimized transient overshoot.\n"
    },
    {
        "level": "##",
        "title": "I. Introduction",
        "content": "\nWith increasing concern for climate change, global efforts have been made in recent years to reduce carbon emissions. To mitigate the pollution from fossil-based power generation and achieve lower carbon emissions, renewable energy sources (RES) such as solar, wind, and hydro are being integrated on a large scale into the power network. These RES, often supplemented with energy storage devices like batteries, are connected to the grid through DC/AC inverters. Currently, most inverters operate in grid-following (GFL) mode, where the grid controls voltage and frequency while the inverter supplies power. However, achieving high RES penetration with GFL inverters poses challenges.\n\nIn microgrids, especially when grid-isolated, sudden large power events like load or generational changes can strain voltage regulation, resulting in significant deviations from nominal values. Similar deviations happen in grid-tied setups due to factors such as weather disturbances and uncertainties in power production, which worsen with high penetration of RES. Conventional GFL-based inverter control designs lack robustness against these deviations, leaving grid viability solely on Grid-Forming (GFM) inverters. However, if GFM inverters are overwhelmed by sudden changes, cascading failures may lead to grid instability.\n\nOne explored approach [1] is Frequency-Watt (FW) control. Here, the inverter maintains a desired power set-point within a specific frequency range. However, if the frequency exceeds this range, the inverter follows a droop curve instead of the precise set-point. While this method enhances grid stability, it struggles in weak microgrids where frequency\n1\nDepartment of Mechanical Science and Engineering, University of Illinois at Urbana-Champaign,\n61801\nIL, USA\najaesang4@illinois.edu,baskaria2@illinois.edu,csalapaka@illinois.edu control is lax, resulting in erratic power injection. Moreover, when the frequency drops below the nominal value, continuous power injection attempted by the inverter control design may not be sustainable over long intervals, posing operational challenges. In contrast, [2] introduces virtual inertia, simulating synchronous machine dynamics, where the energy stored in DC link capacitors to mechanical inertia in synchronous machines, aiming to emulate traditional power generation behaviors that enhance grid stability. While it excels in steady-state active power tracking and frequency support, it mainly focuses on the active power-to-frequency response, neglecting dynamics of reactive power and voltage.\n\nRelevant studies, such as those by [3] and [4], explore control strategies transitioning GFL and GFM modes. Here inverter control is changed from GFL to GFM based on amplitude/frequency deviations from nominal values. While suitable for grid-tied operations with occasional deviations, in weaker microgrids, operating all inverters in GFM mode might not be efficient. Our proposed control design enables inverters to switch to GFM-like voltage regulation only during rapid load or generation changes, operating as GFL inverters during gradual changes. This assists full-time GFM inverters during extreme power fluctuations while providing commanded power, like maximum power point tracking, during stable periods.\n\nWe make use of algebraic structures in our control design to enable transitions between GFL and GFM modes; thus facilitating smooth transitions of microgrids between gridtied and grid-isolated states. In the event of a main power grid anomaly, RES can disconnect and form a microgrid, preventing a complete blackout. Our transition capability ensures the grid-isolated microgrid includes a GFM inverter for regulating frequency and voltage, while allowing other GFL inverters to connect, ensuring the presence of a GFM inverter within the newly formed microgrid consistently. The proposed control retains the functional advantages and stability aspects of the control strategies developed in [4]. The main distinctive feature is that our control design enables smooth transitions while *ensuring* safe transient voltage characteristics. In contrast, the strategy in [4] does not guarantee transient characteristics during transitions. For instance, their methods may introduce sudden jumps in the controller output when switching modes, potentially causing grid instability. Using the proposed GFL inverter, we demonstrate about 44% reduction in the Rate of Change of Frequency (RoCof) during sudden load changes compared to using a conventional GFL inverter. Additionally, with the proposed smooth transition algorithm, during the transition from GFL to GFM, we demonstrate that we can achieve only 1% of overshoot in active power compared to the sudden transition and no overshoot in reactive power.\n"
    },
    {
        "level": "##",
        "title": "Ii. Overview Of The Conventional Gfl And Gfm Inverter A. Modeling Of Inverter Connected To A Grid",
        "content": "\nA\nDC\nsource power (e.g., RES) is transacted with an AC power grid using an inverter. An inverter with an LC filter connected to a grid can be modeled as in Fig. 1. It converts DC\nto AC using fast switching of transistors. A power converter (not shown here) takes power from the source and maintains a constant voltage Vdc at its output. The control design on the converter achieves voltage regulation by using capacitance or battery storage on the DC side. The inverter's switchaveraged model, depicted in Fig. 1, uses the modulating signal m \u2208 [\u22121, 1] as a control parameter. This signal is actuated using pulse-width modulated (PWM) signals, which determine duty cycles governing the switching. The averaged model resembles a controlled voltage source with output voltage m Vdc\n2 . However, to suppress high-frequency switching noise, an LC filter with resistance Ri, inductance Li, and capacitance Ci is employed. This filter mitigates noise in the filter current iL and the capacitor voltage Vc, which serves as the inverter's output voltage interfacing with the grid. The grid, represented as a voltage source with voltage Vg, is separated from the inverter by line impedance, modeled by line resistance Rg and inductance Lg. The output current ig from the inverter is the power transacted with the grid.\n"
    },
    {
        "level": "##",
        "title": "B. Response Of Conventional Gfl To Perturbation",
        "content": "\nThe main goal of a GFL is to control its output power.\n\nSince the output power depends on the output current ig and the capacitor voltage Vc, where Vc can be measured, its goal is converted to a controlling output current ig.\n\nNote that typically the control signal m is designed to make the inductor current iL track iL,ref, where the reference iL,ref is appropriately designed to make ig track ig,ref. In direct-quadrature (dq) coordinates, the dynamics between iL\nand ig is given by the capacitor dynamics as follows [5]\n\n$$\\hat{i}_{g}^{d,q}=\\hat{i}_{L}^{d,q}-C_{i}\\hat{V}_{c}^{d,q}s\\pm C_{i}\\omega\\hat{V}_{c}^{q,d}\\tag{1}$$\n\nwhere superscript $d$ and $q$ respectively represent the direct and quadrature components, while the hat notation denotes the s-domain signal. Additionally, $\\omega$ denotes the grid voltage frequency.\n\nHere by choosing $\\hat{i}_{L,ref}^{d,q}=\\hat{i}_{g,ref}^{d,q}\\mp C\\omega\\hat{V}_{c}^{q,q}$ and designing the filter current controller with a large bandwidth, the \n\ncoupling terms C\u03c9V d\n                   c\n                      and C\u03c9V q\n                               c\n                                  cancel out and \u02c6id,q\n                                                  L\n                                                     \u2248\n\u02c6id,q\nL,ref resulting in the following dynamics given by\n\n$$\\hat{V}_{c}^{d,q}=\\frac{1}{C_{i}s}(\\hat{i}_{g,ref}^{d,q}-\\hat{i}_{g}^{d,q})\\tag{2}$$\nIn addition to this, the frequency of the GFL control is determined by the PLL, which takes V q c as an input:\n\n\u02c6\u03c9 = K*P LL*(s) 1 Cis(\u02c6iq g,ref \u2212\u02c6iq g) + \u02c6\u03c90. (3)\n\nIn this paper, we use subscript 0 to denote nominal values\nand superscript \u2212 to represent amplitude of the underlying\nsignals. Note that by assuming that the PLL accurately\nestimates the phase of the capacitance voltage, one can easily\ndeduce from d-q transformations that V d\n                                      c \u2248 \u00afVc and V q\n                                                    c \u2248 0.\nAlso, it is easy to show that P =\n                                      3\n                                      2(V d\n                                         c id\n                                            g + V q\n                                                  c iq\n                                                    g) and\nQ =\n      3\n      2(\u2212V d\n            c iq\n              g + V d\n                    c iq\n                       g), id\n                           g and iq\n                                   g can be approximated\nas id\n   g =\n          2\n\n3V0 , id\n      g,ref =\n                2\n\n3V0 P0, iq\n        g = \u2212 2\n\n                                         3V0 Q, and iq\n                                                     g,ref =\n\u2212 2\n\n3V0 Q0. See [5] for these d-q transformation details.\nFrom (2) and (3), we obtain\n\n$$\\hat{V}_{c}=\\frac{2}{3V_{0}C_{i}s}(\\hat{P}_{0}-\\hat{P}),\\quad\\hat{\\omega}=\\hat{\\omega}_{0}-\\frac{2K_{PLL}(s)}{3V_{0}C_{i}s}(\\hat{Q}_{0}-\\hat{Q}).\\tag{4}$$\nSince the PI controller is widely used for K*P LL*(s), without loss of generality, both equations in (4) include at least one pure integrator. Therefore, they have infinite DC gain. Consequently, if there is a mismatch between the nominal output power and the actual output power, the GFL inverter cannot regulate voltage and frequency.\n\nIn addition, in (4), the nominal voltage V0 is a grid parameter that we cannot change. Moreover, Ci is chosen to be small, just enough to reject the switching noise of a transistor, to minimize the effect of Vc on ig. This makes the bandwidth of\n2\n3V0Cis large. Therefore, a high-frequency disturbance in output power propagates to the inverter voltage and frequency, potentially leading to grid instability.\n\nSome literature, like [6], proposes a GFL design that considers the bandwidth between active/reactive power and voltage/frequency. However, in most conventional designs, as mentioned earlier, this bandwidth is not adequately considered. Typically, only the bandwidth of the current controller and PLL are taken into account. Consequently, the bandwidth of (4) unintentionally becomes large, as noted.\n"
    },
    {
        "level": "##",
        "title": "C. Response Of Gfm To Perturbation",
        "content": "\nUnlike GFL, the goal of GFM is to control the output voltage Vc. The corresponding control designs typically accommodate uncertainties in power generation and consumption, which translate into mismatches between the commanded and actual power transactions. Since physically it is impossible to accommodate these power mismatches without compromising the voltage (amplitude and frequency) regulation, the control laws allow the amplitude and frequency to *droop* or deviate from the nominal values; however, in a controlled manner.\n\nThere are several types of droop control strategies depending on the types of output line impedance. However, even though the line impedance could vary in type, in most cases, it is inductive due to the presence of long transmission lines. Therefore, for simplicity, we assume a purely inductive line, and its droop strategy becomes the Pf \u2212 QV type of droop\n[7], expressed as:\n\n$$\\hat{\\omega}=\\hat{\\omega}_{0}+K_{P}(\\hat{P}_{0}-\\hat{P}),\\quad\\hat{V}_{ref}=\\hat{V}_{0}+K_{Q}(\\hat{Q}_{0}-\\hat{Q}).\\tag{5}$$\n\nHere, $K_{P}(s)=k_{p}\\frac{\\omega_{1pf}}{s+\\omega_{1pf}}$, $K_{Q}(s)=k_{q}\\frac{\\omega_{1pf}}{s+\\omega_{1f}}$\n\n$\\hat{\\omega}_{1}$\\(\\hat{\\omega}_{1}\n\ns+\u03c9lpf , and kp and kq are the slope of the curve, while\n\u03c9lpf s+\u03c9lpf is a low pass filter for power calculation.\n\nBoth dynamics given in (5) have a finite dc-gain as they have no pole at the origin. Furthermore, kp, kq, and\n\u03c9lpf are design parameters, and by changing them, we can make the frequency and voltage insensitive to high-frequency disturbances of the output power. Therefore, even if there is a mismatch in nominal and actual output power, they can regulate the frequency and the magnitude of the voltage.\n\nTherefore, when there are GFM inverters and conventional GFL inverters in the grid, when there is a disturbance of power, conventional GFL inverters do not contribute to voltage stability, and only GFM inverters respond to power mismatches and ensure a corresponding modified setpoint. However, in a network that has many GFL inverters, substantial and sudden power mismatches can overwhelm GFM inverters, thus compromising network stability. This motivates control designs where GFL inverters are more responsive to power uncertainties.\n\nRemark: The power-grid network robustness discussed above is also referred to as inertia in some existing literature such as [2] and [8], where intuition is developed by developing analogies with a synchronous generator used in well-studied power plants. Here, we establish this connection in the context of our analysis. In a synchronous machine, the mechanical rotor acts as an energy storage device, the energy stored in the rotor being given by E = 1\n2J\u03c92, where J is the rotor moment of inertia, and \u03c9 is the rotating speed. Therefore, the rotor provides a mechanical means of absorbing or providing instantaneous power and prevents sudden changes in the rotating frequency of a synchronous machine. The swing equation and governor equations in (6) capture the dynamical behavior of the rotor frequency\n\n$$J\\frac{d\\omega}{dt}=T_{in}-T_{out}-D\\omega,\\quad T_{in}=T_{0}+k_{\\omega}(\\omega_{0}-\\omega),\\tag{6}$$\nwhere Tin is input torque comes from the governor, Tout is torque output due to electricity generation, and T0 is nominal torque. Furthermore, D represents the damping of the rotor and k\u03c9 is the governor droop coefficient. Using the approximation P0 = T0\u03c90 and P = Tout\u03c90, where P and P0 are, respectively, the actual and nominal output power.\n\nCombining (6) together, as shown in [8], the dynamics of a synchronous generator can be expressed as\n\n$$\\hat{\\omega}=\\hat{\\omega}_{0}+\\frac{1/H}{s+(k_{\\omega}+D)/H}(\\hat{P}_{0}-\\hat{P}),\\tag{7}$$\nwhere H = *J/\u03c9*0. As shown in [9], by defining \u03c9lpf =\n(k\u03c9 + D)/J and kp = 1/(k\u03c9 + D), we can recover the first equation of (5). Also, as the mechanical inertia J\nincreases, the dynamics are less sensitive to changes in power. Therefore, inertia has an equivalent meaning in this context.\n"
    },
    {
        "level": "##",
        "title": "Iii. Proposed Gfl Controller",
        "content": "\nWe propose a control design in which the inverter responds to sudden and fast changes in power mismatches while being insensitive to slow changes. Here, we use our observations from the GFM droop-control design in the previous section, where we propose appropriately designing filters in the droop-control design to enable controllers that are sensitive to time constants of the load/generation perturbations. To be more specific, we will design controllers that mimic conventional GFL designs at low frequencies while mimicking the dynamics of (5) at frequencies higher than its cut-off frequency \u03c9lpf.\n"
    },
    {
        "level": "##",
        "title": "A. Power-Injecting Dynamics",
        "content": "\nThe primary objective of GFL inverter is to control its output power. Designing such a controller using a droopcontrol structure requires analyzing the power-injecting dynamics. The droop equation relates output voltage amplitude and frequency to nominal and actual active/reactive power. However, these voltages and frequencies also impact active/reactive power. Illustrated in [10], this voltagefrequency-to-power relationship forms a feedback loop. Analyzing closed-loop power injection dynamics necessitates understanding power transaction dynamics. This relationship is given in the context of Fig 1, where the power transactions (P and Q) between the inverter output (specified by the output of the capacitor) and the point of coupling at the grid are given by P + jQ = \u00afVcej\u03b8c\ufffd \u00af\nVcej\u03b8c\u2212 \u00af\nVgej\u03b8g\n\n                                                 \u00af\n                                                 Zgej\u03d5\n                                                          \ufffd\u2217,\nwhere \u00af\n       Zgej\u03d5 = Rg + j\u03c90Lg represents the line impedance.\nAssuming a long transmission line, we have \u03d5 \u2248 90\u25e6. By\nlinearizing this equation around \u03b8c \u2212 \u03b8g = 0 and \u00afVg = V0,\n\nwe obtain\n         \ufffdP\n           Q\n\n\ufffd\n =\n    V0\n    \u00af\n    Zg\n\n\ufffd0\n   1\n 1\n   0\n\n\ufffd \ufffd \u00afVc \u2212 \u00afVg\n     V0\u03b4\n\n\ufffd\n . In what follows,\n\nwe assume that we have a voltage controller with a large\nbandwidth and therefore \u02c6Vc = \u02c6Vc,ref. Now we relate \u03c9 to\n\u03b4 by \u03b4 =\n          \ufffd t\n           0(\u03c9 \u2212 \u03c90)ds \u2212\n                          \ufffd t\n                           0(\u03c9g \u2212 \u03c90)d\u03c4. By combining\n(5) and using these relations, we derive the block diagram\nof closed-loop power injecting dynamics as shown in Fig. 2.\nHere, \u02c6d = [ \u02c6\u00afVg \u2212 \u02c6\u00afV0, \u02c6\u03c9g \u2212 \u02c6\u03c90]T and \u02c6p = [ \u02c6P, \u02c6Q]T respectively\nrepresent amplitude and frequency deviations, and actual\nactive and reactive power components.\n\nSince the dynamics from \u02c6P0 to \u02c6P and the dynamics from\n\u02c6Q0 to \u02c6Q are decoupled, they can be expressed as two Single-\nInput Single-Output (SISO) systems as\n\n$$\\hat{P}=\\frac{V_{0}^{2}K_{P}}{s\\bar{Z}_{g}+V_{0}^{2}K_{P}}\\hat{P}_{0}+\\frac{V_{0}^{2}}{s\\bar{Z}_{g}+V_{0}^{2}K_{P}}(\\hat{\\omega}_{g}-\\hat{\\omega}_{0}),\\tag{8}$$ $$\\hat{Q}=\\frac{V_{0}K_{Q}}{\\bar{Z}_{g}+V_{0}K_{Q}}\\hat{Q}_{0}+\\frac{V_{0}}{\\bar{Z}_{g}+V_{0}K_{Q}}(\\hat{V}_{g}-\\hat{V}_{0}).\\tag{9}$$\n"
    },
    {
        "level": "##",
        "title": "B. Design Of The Controller",
        "content": "\ns + \u03f5P s + \u03f5Q s + \u03c9lpf \ufffd . (10)\n\n  For our control design, we consider the following criteria\n  1) Reference tracking: First, as discussed in the previous\nsection, the goal of the GFL inverter is power tracking. At the\nvery least, this should achieve steady-state power tracking.\nIn frequency domain, it is is equivalent to\n                                             \u02c6p(j0)\n                                             \u02c6p0(j0) \u2248 I and\n\u02c6p(j0)\nd(j0) \u2248 0. To achieve this, we propose the following control\nstructure for [KP , KQ] =:\n \ufffd\ufffd\n   kp,P +\n             ki,P\n\n\ufffd , \ufffd kp,Q + ki,Q \ufffd\ufffd \ufffd \u03c9lpf\n\nNote that setting \u03f5P = \u03f5Q = 0 achieves\n                                            h(j0)\n                                           h0(j0) = I and\nh(j0)\nd(j0) = 0. Additionally, by choosing \u03f5P , \u03f5Q > 0, one\ncan introduce robustness as a trade-off between performance.\nFinally, \u03f5P and \u03f5Q will be used in transition between GFL\nand GFM, a topic we will discuss later.\n  2) Stability: With the controller given in (10), the losed-\nloop characteristic polynomial for the system in (8) is s3 +\n(\u03c9lpf +\u03f5P )s2+(\u03c9lpf\u03f5P + V 2\n                           0\n\nZg \u03c9lpfkp,P )s+ V 2\n             0\n\n                                Zg \u03c9lpf(kp,P \u03f5P +\nki,P ). Then, from the Routh-Hurwitz stability criterion if\n\u03c9lpf \u2212ki,P /kp,P > 0, it is stable. Also, for the second-order\nsystem in (9), since all the coefficients are positive, it stable\nfor any kp,Q, ki,Q > 0.\n 3) Robustness against a high-frequency perturbation:\nFinally, among the controllers that meet the reference track-\ning and stability conditions mentioned above, our objective\nis to find the controller that mimics the response in (5)\nfor \u03c9 > \u03c9lpf. With small \u03f5P , \u03f5Q, this can be achieved\nby setting ki,P = kp and ki,Q = kq while ensuring that\nki,P /kp,P \u2264 \u03c9lpf and ki,Q/kp,Q \u2264 \u03c9lpf.\n"
    },
    {
        "level": "##",
        "title": "Iv. Smooth Transition Between Gfl And Gfm",
        "content": "\nNow we consider the implementation of control schemes that achieve transitions from GFL to GFM modes or vice versa, as desired. These transitions may be motivated by various reasons - for instance, decisions to go from grid-tied to grid-isolated modes. It turns out that we can achieve this by modifying parameters \u03f5P and \u03f5Q of our control design in (10). Specifically, when \u03f5P *, \u03f5*Q small, we obtain the GFL controller as previously designed. Conversely, selecting\n\u03f5P = \u03f5Q = \u03f5max for some large \u03f5max mimics a GFM defined in (5), as it derives ki,P\ns+\u03f5P \u2248 0 and ki,Q\ns+\u03f5Q \u2248 0.\n"
    },
    {
        "level": "##",
        "title": "A. Proposed Transition Strategy",
        "content": "\n1) GFL to GFM: The transition from GFL to GFM proposed in [4] is equivalent to change \u03f5P and \u03f5Q in (10) from\n0 to \u221e abruptly. However, this abrupt change introduces a sudden variation in the control signal, potentially causing high-frequency perturbations in the grid and leading to grid instability. To mitigate this issue, we propose a smooth transition method that gradually ramps up \u03f5P and \u03f5Q from\n0 to \u03f5max.\n\n2) GFM to GFL: On the other hand, when switching from GFM to GFL, even if we suddenly make \u03f5 to 0, the control signal does not experience abrupt changes. Therefore, to facilitate the transition from GFM to GFL, we use a jump from \u03f5max to 0.\n"
    },
    {
        "level": "##",
        "title": "B. Transition Stability",
        "content": "\n  First consider the transition stability of active power\ndynamics during the transition. As shown in the previ-\nous section, if a controller satisfies the stability conditions\nmentioned above, the system in (8) is stable for each\n\u03f5P \u2208 [0, \u03f5max]. However, when \u03f5P varies, it becomes non-\nautonomous system and the stability of each time instance\nis not sufficient to guarantee overall stability.\n  Now, let AP (\u03f5P ) be the state matrix of a state space model\nof (8) corresponding to a given \u03f5P . Given that the system\nis stable for each \u03f5P , AP (\u03f5P ) is Hurwitz. Next, consider\na solution to the Lyapunov equation A\u22a4\n                                        P (\u03f5P )WP (\u03f5P ) +\nWP (\u03f5P )AP (\u03f5P ) = \u2212I. Since AP (\u03f5P ) is Hurwitz for each\n\u03f5P \u2208 [0, \u03f5max], the eigenvalues of WP (\u03f5P ) are all strictly\npositive. Finally, let VP (t) = x\u22a4\n                             P (t)WP (\u03f5P (t))xP (t), where\nxP is a state variable, be a Lyapunov candidate.\n  If there exists a finite \u03b1 > 0 such that VP (t) \u2264 \u03b1VP (0),\nthen by Rayleigh Ritz theorem,\n\n$$\\|x_{P}(t)\\|_{2}^{2}\\leq\\alpha\\frac{\\max_{\\epsilon_{P}\\in[0,\\epsilon_{max}]}\\bar{\\lambda}(W_{P}(\\epsilon_{P}))}{\\min_{\\epsilon_{P}\\in[0,\\epsilon_{max}]}\\bar{\\lambda}(W_{P}(\\epsilon_{P}))}\\|x_{P}(0)\\|_{2}^{2}.\\tag{11}$$\n\nSince the eigenvalues of WP (\u03f5) are strictly positive and\n[0, \u03f5max] is a closed interval, min\u03f5P \u2208[0,\u03f5max] \u03bb(WP (\u03f5P )) >\n0, and the upper bound is finite. Therefore, for any \u03f5 > 0,\nthere exists \u03b4 > 0 such that if \u2225x0\u2225 \u2264 \u03b4, \u2225x(t)\u2225 \u2264 \u03f5 and\ntherefore, the system is stable.\n\nProposition 1. There exists a finite \u03b1 > 0 during the\ntransition.\n\n  Proof 1. By taking the derivative of the Lyapunov candi-\ndate function and applying Rayleigh Ritz theorem, we obtain\n\n\u02d9VP (t) \u2264 \u00af\u03bb( \u02d9WP (\u03f5P (t)) \u2212 I)\u2225xP (t)\u22252\n                                                     2 \u2264 q(t)VP (t), where\n\n|\u00af\u03bb( \u02d9WP (\u03f5P (t)))|\n\nq(t) =\n\nmin\u03f5P \u2208[0,\u03f5max] \u03bb(WP )\n                      if \u02d9\u03f5P \u0338= 0\n\n\u2212\n      1\n\n$$\\left\\{\\begin{array}{l}{{}}\\\\ {{}}\\end{array}\\right.$$\n\nmax\u03f5P \u2208[0,\u03f5max] \u00af\u03bb(WP )\n                  if \u02d9\u03f5P = 0\n\nNote that during the transition $\\dot{\\epsilon}_{P}\\neq0$, and $\\bar{\\lambda}(\\dot{W}_{P}(\\epsilon_{P}(t))-I)=\\bar{\\lambda}(\\dot{W}_{P}(\\epsilon_{P}(t)))-1\\leq|\\bar{\\lambda}(\\dot{W}_{P}(\\epsilon_{P}(t)))|$. Conversely, when remaining in one mode, $\\dot{\\epsilon}_{P}=0$ and $\\dot{W}_{P}(t)=0$ as $\\dot{W}_{P}=\\frac{\\partial W_{P}}{\\partial\\epsilon_{P}}\\dot{\\epsilon}_{P}$. Then, $\\bar{\\lambda}(\\dot{W}_{P}(\\epsilon_{P}(t))-I)=-1$\n\nBy applying Gronwall-Bellman inequality, we obtain $V_{P}(t)\\leq V_{P}(0)exp\\big{(}\\int_{0}^{t}q(\\tau)d\\tau\\big{)}$, and it is bounded since\n\n$$\\int_{0}^{t}q(\\tau)d\\tau\\leq\\frac{\\max_{\\epsilon_{P}\\in[0,\\epsilon_{max}]}\\|\\partial W_{P}(\\epsilon_{P})/\\partial\\epsilon_{P}\\|}{\\min_{\\epsilon_{P}\\in[0,\\epsilon_{max}]}\\underline{\\lambda}(W_{P})}\\int_{0}^{t}|\\dot{\\epsilon}_{P}(t)|d\\tau$$ $$\\leq\\frac{\\max_{\\epsilon_{P}\\in[0,\\epsilon_{max}]}\\|\\partial W_{P}(\\epsilon_{P})/\\partial\\epsilon_{P}\\|}{\\min_{\\epsilon_{P}\\in[0,\\epsilon_{max}]}\\underline{\\lambda}(W_{P})}\\epsilon_{max},$$\nwhere we choose (and assume) a transition strategy where\n\u03f5P changes monotonically with time.\n"
    },
    {
        "level": "##",
        "title": "\u2202\u0395p Proposition 2. Max\u03f5p \u2208[0,\u0395max] \ufffd\ufffd\ufffd \u2202Wp (\u0395p )",
        "content": "\n\ufffd\ufffd\ufffd is finite.\n\nProof 2. Since the coefficients of the characteristic polynomial (8) are affine with respect to \u03f5P ; therefore AP (\u03f5) is also affine; that is AP (\u03f5P ) = AP (0) + \u03f5P BP for some BP .\n\nAlso\n\u2202\n\n0\n   \u03c4\n     \ufffd\ufffd\ufffdeA\u22a4\n         P (\u03f5P )\u03c4eAP (\u03f5P )\u03c4\ufffd\ufffd\ufffd d\u03c4,\n\n\ufffd\ufffd\ufffd\ufffd \u2264 2\u2225BP \u2225\n                                   \ufffd \u221e\n\nAlso $\\frac{\\partial}{\\partial\\epsilon_{P}}e^{A_{P}(\\epsilon_{P})\\tau}=B_{P}\\tau e^{A_{P}(\\epsilon_{P})\\tau}$.\n\nIf we choose $\\epsilon_{P}(t)$ to be a smooth function of $t$, and using $W_{P}=\\left(e^{A_{P}^{\\top}(\\epsilon_{P})\\tau}e^{A_{P}(\\epsilon_{P})\\tau}\\right)$, we get\n\n$$\\left\\|\\frac{\\partial W_{P}}{\\partial\\epsilon_{P}}\\right\\|\\leq2\\|B_{P}\\|\\int_{0}^{\\infty}\\tau\\left\\|e^{A_{P}^{\\top}(\\epsilon_{P})\\tau}e^{A_{P}(\\epsilon_{P})\\tau}\\right\\|\\,d\\tau,$$\n\nwhere since $A_{P}(\\epsilon_{P})$ is Hurwitz, $\\|e^{A_{P}^{\\top}(\\epsilon_{P})\\tau}e^{A_{P}(\\epsilon_{P})\\tau}\\|\\leq\\epsilon_{P}\\tau$, $\\epsilon_{P}$ is a smooth function of $\\epsilon_{P}$.\n\nwhere since AP (\u03f5P ) is Hurwitz, \u2225eA\u22a4\n                                   P (\u03f5P )\u03c4eAP (\u03f5P )\u03c4\u2225 \u2264\ne\u2212\u03bbP \u03c4 for some \u03bbP > 0. As a result, it is bounded for each\n\u03f5P . Furthermore, since [0, \u03f5max] is a closed and bounded\ninterval, max\u03f5P \u2208[0,\u03f5max] \u2225\u2202WP /\u2202\u03f5P \u2225 is bounded.\n  For multiple transitions, if there is a time gap of at least\nmax\u03f5P \u2208[0,\u03f5max] \u00af\u03bb(WP )\n                    max\u03f5P \u2208[0,\u03f5max] \u2225\u2202WP (\u03f5P )/\u2202\u03f5P \u2225\n\n                             min\u03f5P \u03bb(WP )\n                                                \u03f5max\nbetween the end of one transition and the start of new\ntransition, it ensures that VP (T) < VP (0) where T is\nthe time when the new transition start. Then, the same\nupper bound for V (t) can be applied to the new transition,\nensuring stability.\n  Similar procedures can be followed for analyzing the\ntransition stability of reactive power dynamics.\n"
    },
    {
        "level": "##",
        "title": "V. Simulation Results",
        "content": "\nImplementation: We designed the droop controller for the proposed GFL inverter under the assumption that we have a voltage controller with a large bandwidth. To design such a controller, let us first consider the dynamics of the LC filter of the inverter in Fig. 1. In dq coordinates, the dynamics of the LC filter are given as follows:\n\n$$L_{i}\\frac{di_{L}^{d,q}}{dt}=m^{d,q}\\frac{V_{dc}}{2}\\pm L_{i}\\omega i_{L}^{q,d}-V_{c}^{d,q}-R_{i}i_{L}^{d,q}\\tag{12}$$\n\nBased on [5], with the current controller $K_{c}$ and feedback linearizing control that cancels out the $d$ and $q$ coupling terms, the control input can be represented as follows\n\n$$\\hat{m}^{d,q}=\\frac{K_{c}(\\hat{i}_{L,ref}^{d,q}-\\hat{i}_{L}^{d,q})\\mp L_{i}\\omega_{0}^{2q,q}+\\hat{V}_{c}^{d,q}}{V_{dc}/2}.\\tag{13}$$\n\nThen, \u02c6id,q\n      L\n          = Tc\u02c6id,q\n                L,ref where Tc =\n                                    KcGi\n\n                             1+KcGi and Gi =\n1\n\nLis+Ri . On top of the current control in (13), by choosing\niL,ref as\n\n$$\\hat{i}^{d,q}_{L,ref}=K_{v}(\\hat{V}^{d,q}_{c,ref}-\\hat{V}^{d,q}_{c})\\mp C_{i}\\omega_{0}\\hat{V}^{q,d}_{c}+\\hat{i}^{d,q}_{g},\\tag{14}$$\n\none can achieve $\\hat{V}^{d,q}_{c}=T_{v}\\hat{V}^{d,q}_{c,ref}$, where $T_{v}=\\frac{K_{v}T_{c}G_{v}}{1+K_{v}T_{c}G}$\n\n                                        1+KvT cGv\nand Gv =\n         1\n\n       Cis.\n In this experiment, controllers with the following structure\nare utilized:\n\n$$K_{c}=\\frac{L_{i}s+R_{i}}{\\tau_{c}s},\\quad K_{v}=k_{p,V}+\\frac{k_{i,V}}{s},\\tag{15}$$\nwhere parameters \u03c4c, kp,V , and ki,V are tuned to have enough bandwidth. Also, the conventional GFL that is used for comparison is using the same Kc.\n\nThe proposed controller and the conventional GFL were implemented and tested using the MATLAB Simscape toolbox with a step size of 0.05 s. The grid and inverter parameters used in the simulations are as follows: Ri = 0.2\u03a9, Li = 3.3mH, Ci = 40\u00b5F, Rg = 0.1\u03a9, Lg = 1.86mH.\n\nAdditionally, the nominal voltage and frequency are set to V0 = 391V and f0 = 60Hz. The chosen controller parameters are kp,P = 0.2, rad/(s \u00b7 kW), ki,P = 0.1\u03c9lpf \u00b7 kp,P , kp,Q = 0.2 V/kVAR, and ki,Q = \u03c9lpf \u00b7 kp,Q.\n\n(a) Power Tracking: First, we evaluate the active and reactive power tracking of the proposed controller with filter cutoff frequencies (\u03c9lpf) set to 4\u03c0 rad/s, 5\u03c0 rad/s, and\n20\u03c0 rad/s. We assume that the inverter with the proposed controller is connected to a stiff grid with \u03c9g = \u03c90 and Vg =\nV0. As shown in Fig.3, at t = 1 second, the active power reference is changed from 10kW to 12kW, and at t = 4 second, the reactive power set point is changed from 0kVAR to 2kVAR. Similarly, at t = 7 seconds, the active power P0 changes from 12kW to 8kW, and at t = 10 seconds, the reactive power Q0 changes from 2kVAR to -1kVAR.\n\nThe proposed controller achieves steady-state tracking just as conventional GFL.\n\n(b) Response to Fast and Slow Load Changes: For checking the frequency and voltage support of the proposed GFL, consider the case where the GFL inverter is connected to the GFM inverter, forming a weak microgrid. Initially, there is a 20kW active load and a 10kVAR reactive load, and the GFL inverter injects 10kW of active power. Throughout this scenario, P0 = 10kW and Q0 = 0*V AR*. At t = 1s,\n5kW of active load and 5kVAR of reactive load are added to the grid. Then, the response is given as Fig.4\nFor conventional GFL, active and reactive output power converge to the reference value immediately. Then, a GFM inverter solely handles load changes and experiences a huge rate of change of frequency (RoCoF). However, with the proposed controller, in the event of a load change, the GFL inverter temporarily supplies power, resulting in smaller voltage and frequency peaks and reduced RoCoF until the grid reaches new steady-state values. When conventional GFL shows a RoCoF of 1.74 Hz/s, the proposed controllers with\n\u03c9lpf of 4\u03c0, 10\u03c0, and 20\u03c0 achieve 0.89 Hz/s, 0.93 Hz/s, and\n0.98 Hz/s, respectively, which represent 51.35%, 53.30%, and 56.00% of the RoCoF compared to the conventional GFL\ncase. Additionally, the proposed GFL controller provides damping on the voltage.\n\nAlso, to verify that the proposed controller follows the power reference point and does not react to a slow load change, we apply 5 kW and 5 kVAR of active and reactive load changes over 5 seconds in a ramp manner to a microgrid with one GFM inverter and a proposed GFL inverter with\n\u03c9lpf = 20\u03c0 rad/s. As seen in Fig. 5, when the load changes slowly, most of the load change is handled by the GFM inverter, and the GFL inverter with the proposed controller maintains its power reference point.\n\nFig. 5: Power sharing between GFM and proposed GFL under slow load change: Blue represents the proposed GFL, Red represents GFM, and Orange represents the total load.\n\n(c) Transition between GFM and GFL: In the same microgrid setup with a GFL inverter utilizing the proposed controller (\u03c9lpf = 20\u03c0 rad/s) and a GFM inverter, a transition between GFL and GFM is tested (Fig. 6). Initially, the proposed controller is in GFL mode. At t = 2 s, the GFL inverter transitions to GFM mode. Parameters \u02d9\u03f5 = 100\nand \u03f5max = 200 are chosen for smooth transition. For comparison, a sudden transition method proposed in [4] is also tested. Both methods exhibit stability, as shown in active and reactive power plots (Fig. 6). However, the smooth transition method demonstrates significantly lower overshoot and fluctuations compared to the sudden transition method. Specifically, during the transition, the sudden method results in a 4.1kW active power overshoot, whereas the proposed method shows only 41W. Similarly, the sudden method leads to a 4.4*kV AR* reactive power overshoot, while the proposed method experiences none.\n\nFurthermore, a transition from the GFM mode to the GFL\nmode is tested at t = 7 s. Here, for both methods, as explained before, \u03f5P and \u03f5Q jump from \u03f5max to 0. Even though the \u03f5 value changes abruptly from \u03f5max to 0, the transient is not significant because in GFL mode, control signals increases gradually and the transient is small.\n"
    },
    {
        "level": "##",
        "title": "Vi. Conclusions",
        "content": "\nIn this paper, we evaluate the robustness of conventional GFL and GFM inverters against power perturbations by analyzing their power-to-voltage responses. We observe that conventional GFL exhibits sensitivity to perturbations, whereas the droop control structure in GFM enables shaping of this sensitivity. Motivated by this, we propose a GFL control structure that is insensitive to high-frequency load perturbations and tracks low-frequency power references. Furthermore, drawing on the structural similarity between the proposed GFL controller and the GFM controller, we devise a smooth transition strategy between GFL and GFM modes. This strategy minimizes power overshoot and oscillation during the transition.\n"
    },
    {
        "level": "##",
        "title": "References",
        "content": "\n[1] M. Elkhatib, J. Neely, and J. Johnson, \"Evaluation of fast-frequency\nsupport functions in high penetration isolated power systems,\" in 2017\nIEEE 44th Photovoltaic Specialist Conference (PVSC).\nIEEE, 2017,\npp. 2141\u20132146.\n[2] Y. Qi, H. Deng, X. Liu, and Y. Tang, \"Synthetic inertia control of gridconnected inverter considering the synchronization dynamics,\" IEEE Transactions on Power Electronics, vol. 37, no. 2, pp. 1411\u20131421, 2021.\n[3] J. Wang and G. Saraswat, \"Study of inverter control strategies on\nthe stability of low-inertia microgrid systems,\" in IECON 2022\u201348th Annual Conference of the IEEE Industrial Electronics Society. IEEE, 2022, pp. 1\u20136.\n[4] S. Chakraborty, S. Patel, G. Saraswat, A. Maqsood, and M. V.\nSalapaka, \"Seamless transition of critical infrastructures using droop controlled grid-forming inverters,\" IEEE Transactions on Industrial Electronics, 2023.\n[5] A. Yazdani and R. Iravani, Voltage-sourced converters in power\nsystems: modeling, control, and applications.\nJohn Wiley & Sons,\n2010.\n[6] A. Askarian, J. Park, and S. Salapaka, \"Enhanced grid following\ninverter (e-gfl): A unified control framework for stiff and weak grids,\" IEEE Transactions on Power Electronics, 2024.\n[7] Q.-C. Zhong and Y. Zeng, \"Universal droop control of inverters with\ndifferent types of output impedance,\" *IEEE access*, vol. 4, pp. 702\u2013\n712, 2016.\n[8] J. Driesen and K. Visscher, \"Virtual synchronous generators,\" in\n2008 IEEE power and energy society general meeting-conversion and\ndelivery of electrical energy in the 21st century.\nIEEE, 2008, pp.\n1\u20133.\n[9] J. Liu, Y. Miura, and T. Ise, \"Comparison of dynamic characteristics\nbetween virtual synchronous generator and droop control in inverterbased distributed generators,\" IEEE Transactions on Power Electronics, vol. 31, no. 5, pp. 3600\u20133611, 2015.\n[10] A. Askarian, J. Park, and S. Salapaka, \"Control design for inverters:\nBeyond steady-state droop laws,\" *arXiv preprint arXiv:2105.02292*,\n2021."
    }
]