[
    {
        "level": "#",
        "title": "Virtuoso: An Open-Source, Comprehensive And Modular Simulation Framework For Virtual Memory Research",
        "content": "\nKonstantinos Kanellopoulos1\nKonstantinos Sgouras2\nOnur Mutlu1\nETH Z\u00fcrich1 University of Athens2\n"
    },
    {
        "level": "##",
        "title": "1 Introduction & Background",
        "content": "\nVirtual memory is a cornerstone of modern computing systems.\n\nIntroduced as one of the earliest instances of hardware-software co-design, VM facilitates programmer-transparent memory management, data sharing, process isolation and memory protection.\n\nIn light of current application trends with large data sets and irregular memory access patterns [4, 5, 14, 42, 47] and as we transition to much larger address spaces [8] (e.g., hybrid memory systems with both volatile and non-volatile memories [1, 37]) and heterogeneous memory systems [32], the overheads of virtual memory are likely to increase [39]. Research span across various solutions to reduce the overheads of virtual memory in the context of (i) improving the efficiency of the TLB subsystem [17, 22, 33, 35, 48] (e.g., software-based TLB [35] etc.), (ii) the efficiency of page table structures [30, 31, 44, 50, 55] (e.g., hash-based page tables [44, 55]), (iii)\naccelerating address translation in virtualized environments [16,\n25, 30, 46, 51], (iv) leveraging contiguity between virtual/physical addresses to enable offset-based address translation [22, 28, 39,\n40, 56] (e.g., range-based translation [27]), (v) enabling hash-based virtual-to-physical address mapping [3, 34, 53], (vi) enabling intermediate address spaces to perform address translation only upon LLC misses [21, 45], (vii) designing efficient large page allocation techniques [9, 20, 26, 38, 56] (e.g., Transparent Huge Pages [20])\nand (viii) reducing the overheads of minor page faults [43, 52].\n"
    },
    {
        "level": "##",
        "title": "2 Lack Of Comprehensive Virtual Memory Simulation Framework",
        "content": "\nEvaluating the efficiency of various virtual memory (VM) designs is crucial (i) given their significant impact on the system, including the CPU caches, the main memory, and the storage device and (ii)\ngiven that different system architectures might benefit from various VM techniques. Such an evaluation is not straightforward, as it heavily hinges on modeling the interplay between different VM\ntechniques and the interactions of VM with the system architecture. To better illustrate the interplay between VM techniques, for example, the memory management policies can directly affect TLB\nperformance [22], contiguity-aware VM solutions significantly influence memory fragmentation [40], affecting disk accesses, while the contiguity between virtual and physical addresses is pivotal for the efficiency of prefetching [10]. As also highlighted in prior works [31, 50], the design of the page table can negatively impact main memory efficiency. With respect to system architecture, mobile devices, with their resource constraints, might benefit from lightweight VM designs that minimize energy overheads. In contrast, cloud architectures, with abundant resources, might favour VM designs that maximize throughput and scalability [7]. In contrast, commercial multi-core architectures, with multiple threads running concurrently, might favour VM designs that reduce contention and ensure efficient memory bandwidth distribution among cores.\n\nIn the face of these intricacies, assessing the merits and drawbacks of old, modern and futuristicVM proposals becomes a highlychallenging task without a comprehensive simulation tool. Modern simulators, however, struggle to keep up with the rapid VM research developments, lacking the capability to model a wide range of contemporary VM techniques and their interactions. Table 1 summarizes the VM techniques that are supported by existing simulators. For example, Sniper [19], does not include a realistic model for the page table walk latency, neither emulates nor simulates the page fault handler and does not emulate memory management.\n\nThe system call emulation mode of gem5 [18] does not include detailed TLB models (e.g., all TLBs are considered fully-associative), and neither emulates nor simulates page fault handling and large page allocation. At the same time, the full system simulation of gem5 emulates and simulates the actual OS including realistic memory management, large page allocation but at the cost of (i) high programmability effort, e.g., enabling contiguity-based translation requires modifying the kernel code in a functional manner and co-design it with the simulated hardware and (ii) high simulation time (e.g., simulating multi-programmed workloads in parallel is not supported). Given the wide range of research directions and the synergies between different VM components, our goal in this work is to provide researchers with an open-source, comprehensive and modular tool to study and evaluate various VM techniques and memory management schemes.\n"
    },
    {
        "level": "##",
        "title": "3 Our Approach: Virtuoso",
        "content": "\nTo this end, we present Virtuoso, an open-source, comprehensive and modular simulation framework that models various VM designs to establish a common ground for virtual memory research.\n\nVirtuoso is built on top of sniper [19] and, as show in Table 1, extends it with (i) state-of-the-art TLB techniques and organizations,\n(ii) four different page table designs from cutting-edge academic proposals, (iii) support for easily configurable Nested MMUs, required in virtualized environments(e.g., MMU with Nested TLB, Nested Walk etc.), (iv) translation techniques that exploit virtual and physical memory contiguity [2, 28] (v) support for address translation schemes that rely on intermediate address spaces [41,\n45], (vi), metadata management schemes that enhance security and performance [13, 36], (vii) a complete memory management emulator that includes a reservation-based programmer-transparent large page allocator and (viii) a new simulation methodology that involves bi-directional inter-process communication between Virtuoso and software to estimate the performance of OS kernel code with a focus on the minor page fault handler. Even though Virtuoso is built on top of Sniper, it is highly-modular, avoiding the use of simulator-specific semantics. The only requirement to integrating Virtuoso in any architectural simulator, is attaching it to the simulator's memory subsystem model (e.g. interface to access the L1 data cache).\n"
    },
    {
        "level": "##",
        "title": "Virtual Memory Components Supported By Existing Simulators And Virtuoso",
        "content": "\nSimulator/\nComponent\nTLB\nSubsystem\nPage Table\nDesign\nContiguity\nSchemes\nIntermediate\nAddress Space\nHash-based\nTranslation\nMetadata\nManagement\nMemory\nManagement\nPage Fault\nModelling\nSimpleScalar [12]\nL1 D-TLB & L1 D-ITLB\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\nPTLSim [15]\nL1 D-TLB & L1 D-ITLB\nSimplistic Walker\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2713\nScarab [6]\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\nRamulator [29]\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\nZSim [24]\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\nMulti2Sim [23]\nL1 D-TLB & L1 D-ITLB\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\nGem5 SE [18]\n2-Level TLB Hierarchy\n4-level Radix-Tree Walker\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\nGem5 FS [18]\n2-Level TLB Hierarchy\n4-level Radix-Tree Walker\n\u2716\n\u2716\n\u2716\n\u2716\nTHP [20]\n\u2713\nChampsim [49]\n2-Level TLB Hierarchy\n4-level Radix-Tree Walker\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\nSniper [19]\n2-Level TLB Hierarchy\nStatic PTW latency\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\n\u2716\nMulti-page Size TLBs\n(Serial probing)\nHash Table with\nOpen-Addressing and PTE\nClustering [31]\nConfigurable\nTLB hierarchy\nMemory-Efficient Hash\nTable [55]\nOffset-based\ntranslation with\nRedundant\nMemory\nMappings [27]\nVirtual Block\nInterface with\nconfigurable\npast-LLC\ntranslation [41]\nVirtuoso\nPage-size Predictors\nElastic Cuckoo\nHash Table [44]\nEager Paging to allocate\nlarge contiguous\nblocks [27]\nTLB prefetching techniques\nConfigurable Radix\n\nTo demonstrate the versatility and utility of Virtuoso we examine four new example case studies.\n\n- We analyze the performance, memory and cache footprint\nof different page table designs under different system workloads (e.g, memory fragmentation and memory bandwidth) and different execution environments (native vs virtualized execution).\n- We perform a head-to-head comparison between large-page,\nintermediate address space and contiguity based schemes taking into consideration (i) address translation latency and\n(ii) impact on memory fragmentation.\n- We examine the performance and microarchitectural impact of Virtuoso's reservation-based large page allocator\nacross different fragmentation levels and compare it against Linux THP.\n- We evaluate the microarchitectural impact caused by minor page faults in the presence of different page allocation policies and contiguity-aware translation approaches.\n"
    },
    {
        "level": "##",
        "title": "4 Our Contributions",
        "content": "\nIn this work, we make the following contributions:\n\n- We present Virtuoso, an open-source, comprehensive and\nmodularsimulatorthat models various virtual memory components and schemes to establish a common ground for\nvirtual memory research.\n- We demonstrate the versatility and the potential of Virtuoso with four new case studies. A minimal, alpha version of the simulator is used in two recent research works [53, 54]. Virtuoso is freely open-source and can be found at https://github.com/CMU-SAFARI/Virtuoso.\n\nMemory Management\nEmulation\nMemory tagging\nwith XMem [36]\nBuddy Allocator with\npre-created memory allocation snapshots\nHybrid address\nmapping with\nUtopia [53]\nReservation-based\nTHP [11]\nBi-directional\ninter-process\ncommunication\nbetween Virtuoso and\ncustom OS Software to\nemulate the\nfunctionality of PF and\nsimulate the\narchitectural events of\nPF\n"
    },
    {
        "level": "##",
        "title": "References",
        "content": "\n[1] Chloe Alverti, Vasileios Karakostas, Nikhita Kunati, Georgios Goumas, and\nMichael Swift. DaxVM: Stressing the Limits of Memory as a File Interface. In\nMICRO 2022.\n[2] Arkaprava Basu, Jayneel Gandhi, Jichuan Chang, Mark D. Hill, and Michael M.\nSwift. Efficient Virtual Memory for Big Memory Servers. In ISCA 2013.\n[3] Krishnan Gosakan, Jaehyun Han, William (Massachusetts Inst. of Technology)\nKuszmaul, Ibrahim Nael Mubarek, Nirjhar Mukherjee, Guido Tagliavini, Evan\nWest, Michael Bender, Abhishek Bhattacharjee, Alex Conway, Martin Farach-\nColton, Jayneel Gandhi, Rob Johnson, Sudarsun Kannan, and Donald Porter.\nMosaic Pages: Big TLB Reach with Small Pages. In ASPLOS 2023.\n[4] Graph 500. Graph 500 Large-Scale Benchmarks. http://www.graph500.org/. [5] Udit Gupta, Xiaodong Wang, Maxim Naumov,Carole-JeanWu, Brandon Reagen,\nDavid Brooks, Bradford Cottel, Kim Hazelwood, Bill Jia, Hsien-Hsin S. Lee, Andrey Malevich, Dheevatsa Mudigere, Mikhail Smelyanskiy, Liang Xiong, and\nXuan Zhang. The Architectural Implications of Facebook's DNN-based Personalized Recommendation. In arXiv 2019.\n[6] Hpsresearchgroup.\n\"hpsresearchgroup/scarab:\nJoint\nhps\nand\neth\nrepository\nto\nwork\ntowards\nopen\nsourcing\nscarab\nand\nramulator.\".\nhttps://github.com/hpsresearchgroup/scarab.\n[7] Bongjoon Hyun, Youngeun Kwon, Yujeong Choi, John Kim, and Minsoo Rhu.\nNeuMMU: Architectural Support for Efficient Address Translations in Neural\nProcessing Units. In ASPLOS '20.\n[8] Intel\nCorp.\n3rd\nGeneration\nIntel\u00ae\nXeon\u00ae\nScalable\nprocessore.\nhttps://www.intel.com/content/www/us/en/products/docs/processors/embedded/3rd-gen-xeon-sc\n[9] Youngjin Kwon, Hangchen Yu, Simon Peter, Christopher J. Rossbach, and Emmett Witchel. Coordinated and Efficient Huge Page Management with Ingens.\nIn 12th USENIX Symposium on Operating Systems Design and Implementation\n(OSDI 16).\n[10] Georgios Vavouliotis, Gino Chacon, Lluc Alvarez, Paul V. Gratz, Daniel A.\nJim\u00e9nez, and Marc Casas. Page Size Aware Cache Prefetching. In MICRO 2022.\n[11] Juan Navarro, Sitaram Iyer, Peter Druschel, and Alan Cox. Practical, Transparent Operating System Support for Superpages. In OSDI.\n[12] D. Ernst T. Austin, E. Larson. SimpleScalar: an infrastructure for computer system modeling. In Computer, ( Volume: 35, Issue: 2, February 2002). IEEE, 59\u201367.\n[13] Emmett Witchel, Josh Cates, and Krste Asanovi\u0107. Mondrian Memory Protection.\nIn ASPLOS.\n[14] Piotr R Luszczek, David H Bailey, Jack J Dongarra, Jeremy Kepner, Robert F\nLucas, Rolf Rabenseifner, and Daisuke Takahashi. The HPC Challenge (HPCC)\nBenchmark Suite. In SC.\n[15] M.T. Yourst. PTLsim: A Cycle Accurate Full System x86-64 Microarchitectural\nSimulator (IEEE International Symposium on Performance Analysis of Systems\nand Software).\n[16] Ravi Bhargava, Benjamin Serebrin, Francesco Spadini, and Srilatha Manne. Accelerating Two-Dimensional Page Walks for Virtualized Systems. In ASPLOS.\n[17] Thomas W. Barr, Alan L. Cox, and Scott Rixner. SpecTLB: A Mechanism for\nSpeculative Address Translation. In ISCA.\n[18] Nathan Binkert, Bradford Beckmann, Gabriel Black, Steven K. Reinhardt, Ali\nSaidi, ArkapravaBasu, Joel Hestness, DerekR. Hower, Tushar Krishna, Somayeh Sardashti, Rathijit Sen, Korey Sewell, Muhammad Shoaib, Nilay Vaish, Mark D.\nHill, and David A. Wood. The gem5 Simulator. Comput. Archit. News (2011).\n[19] Trevor E. Carlson, Wim Heirman, and Lieven Eeckhout. Sniper: Exploring the\nLevel of Abstraction for Scalable and Accurate Parallel Multi-Core Simulations.\nIn SC.\n[20] Jonathan\nCorbet.\nTransparent\nHuge\nPages\nin\n2.6.38.\nhttps://lwn.net/inproceedingss/423584/.\n[21] Arkaprava Basu, Mark D. Hill, and Michael M. Swift. Reducing Memory Reference Energy with Opportunistic Virtual Caching. In ISCA.\n[22] Binh Pham, Viswanathan Vaidyanathan, Aamer Jaleel, and Abhishek Bhattacharjee. CoLT: Coalesced Large-Reach TLBs. In MICRO.\n[23] Rafael Ubal, Byunghyun Jang, Perhaad Mistry, Dana Schaa, and David Kaeli.\nMulti2Sim: A Simulation Framework for CPU-GPU Computing. In PACT.\n[24] Daniel Sanchez and Christos Kozyrakis. ZSim: Fast and Accurate Microarchitectural Simulation of Thousand-Core Systems. In ISCA.\n[25] Jayneel Gandhi, Arkaprava Basu, Mark D. Hill, and Michael M. Swift. Efficient\nMemory Virtualization: Reducing Dimensionality of Nested Page Walks. In MI-\nCRO.\n[26] Yu Du, Miao Zhou, Bruce R Childers, Daniel Moss\u00e9, and Rami Melhem. Supporting Superpages in Non-Contiguous Physical Memory. In HPCA.\n[27] Vasileios Karakostas, Jayneel Gandhi, Furkan Ayar, Adri\u00e1n Cristal, Mark D. Hill,\nKathryn S. McKinley, Mario Nemirovsky, Michael M. Swift, and Osman \u00dcnsal.\nRedundant Memory Mappings for Fast Access to Large Memories. In ISCA.\n[28] V. Karakostas, J. Gandhi, F. Ayar, A. Cristal, M. D. Hill, K. S. McKinley, M. Nemirovsky, M. M. Swift, and O. \u00dcnsal. Redundant Memory Mappings for Fast\nAccess to Large Memories. In ISCA.\n[29] Yoongu Kim, Weikun Yang, and Onur Mutlu. Ramulator: A Fast and Extensible\nDRAM Simulator. In CAL.\n[30] Jayneel Gandhi, Mark D. Hill, and Michael M. Swift. Agile Paging: Exceeding\nthe Best of Nested and Shadow Paging. In ISCA.\n[31] Idan Yaniv and Dan Tsafrir. Hash, Don't Cache (the Page Table). In SIGMETRICS.\n[32] Yang Li, Saugata Ghose, Jongmoo Choi, Jin Sun, Hui Wang, and Onur Mutlu.\nUtility-Based Hybrid Memory Management. In CLUSTER.\n[33] Yashwant Marathe, Nagendra Gulur, Jee Ho Ryoo, Shuang Song, and Lizy K.\nJohn. CSALT: Context Switch Aware Large TLB. In MICRO.\n[34] Javier Picorel, Djordje Jevdjic, and Babak Falsafi. Near-Memory Address Translation. In PACT.\n[35] Jee Ho Ryoo, Nagendra Gulur, Shuang Song, and Lizy K. John. RethInking TLB\nDesigns in Virtualized Environments: A Very Large Part-of-Memory TLB. In\nISCA.\n[36] Nandita Vijaykumar, Abhilasha Jain, Diptesh Majumdar, Kevin Hsieh, Gennady\nPekhimenko, Eiman Ebrahimi, NastaranHajinazar, Phillip B. Gibbons, and Onur Mutlu. A Case for Richer Cross-Layer Abstractions: Bridging the Semantic Gap\nwith Expressive Memory. In ISCA.\n[37] Sihang Liu, Korakit Seemakhupt, Gennady Pekhimenko, Aasheesh Kolli, and\nSamira Khan. Janus: Optimizing Memory and Storage Support for Non-Volatile\nMemory Systems. In ISCA.\n[38] Ashish Panwar, Sorav Bansal, and K Gopinath. Hawkeye: Efficient Fine-grained\nOS Support for Huge Pages. In ASPLOS.\n[39] Zi Yan, Daniel Lustig, David Nellans, and Abhishek Bhattacharjee. Translation\nRanger: Operating System Support for Contiguity-Aware TLBs. In ISCA.\n[40] Chloe Alverti, Stratos Psomadakis, Vasileios Karakostas, Jayneel Gandhi, Konstantinos Nikas, Georgios Goumas, and Nectarios Koziris. Enhancing and Exploiting Contiguity for Fast Memory Virtualization. In ISCA.\n[41] Nastaran Hajinazar, Pratyush Patel, Minesh Patel, Konstantinos Kanellopoulos,\nSaugata Ghose, Rachata Ausavarungnirun, Geraldo F. Oliveira, Jonathan Appavoo, Vivek Seshadri, and Onur Mutlu. The Virtual Block Interface: A Flexible\nAlternative to the Conventional Virtual Memory Framework. In ISCA.\n[42] R. Hwang, T. Kim, Y. Kwon, and M. Rhu.\nCentaur: A Chiplet-based, Hybrid Sparse-Dense Accelerator for Personalized Recommendations. In 2020\nACM/IEEE 47th Annual International Symposium on Computer Architecture\n(ISCA).\n[43] Gyusun Lee, Wenjing Jin, Wonsuk Song, Jeonghun Gong, Jonghyun Bae, Tae Jun\nHam, Jae W. Lee, and Jinkyu Jeong. A Case for Hardware-BasedDemand Paging.\nIn 2020 ACM/IEEE 47th Annual International Symposium on Computer Architecture (ISCA). 1103\u20131116. https://doi.org/10.1109/ISCA45697.2020.00093\n[44] Dimitrios Skarlatos, Apostolos Kokolis, Tianyin Xu, and Josep Torrellas. Elastic\nCuckoo Page Tables: Rethinking Virtual Memory Translation for Parallelism. In\nASPLOS.\n[45] Siddharth Gupta, Atri Bhattacharyya, Yunho Oh, Abhishek Bhattacharjee,\nBabak Falsafi, and Mathias Payer. Rebooting Virtual Memory with Midgard.\nIn ISCA.\n[46] Artemiy Margaritov, Dmitrii Ustiugov, Amna Shahab, and Boris Grot. PTEMagnet: FIne-graIned Physical Memory Reservation for Faster Page Walks in Public\nClouds. In ASPLOS.\n[47] Arun Subramaniyan, Yufeng Gu, Timothy Dunn, Somnath Paul, Md. Vasimuddin, Sanchit Misra, David Blaauw, Satish Narayanasamy, and Reetuparna Das.\nGenomicsBench: A Benchmark Suite for Genomics. In ISPASS.\n[48] Georgios Vavouliotis, Lluc Alvarez, Vasileios Karakostas, Konstantinos Nikas,\nNectarios Koziris, Daniel A. Jim\u00e9nez, and Marc Casas. Exploiting Page Table\nLocality for Agile TLB Prefetching. In ISCA.\n[49] Nathan Gober, Gino Chacon, Lei Wang, Paul V. Gratz, Daniel A. Jimenez, Elvira\nTeran, Seth Pugsley, and Jinchun Kim. The Championship Simulator: Architectural Simulation for Education and Competition. In arXiv.\n[50] Chang Hyun Park, Ilias Vougioukas, Andreas Sandberg, and David Black-\nSchaffer. Every Walk's a Hit: Making Page Walks Single-Access Cache Hits.\nIn ASPLOS.\n[51] Jovan Stojkovic, Dimitrios Skarlatos, Apostolos Kokolis, Tianyin Xu, and Josep\nTorrellas. Parallel Virtualized Memory Translation with Nested Elastic Cuckoo\nPage Tables. In ASPLOS.\n[52] ChandrahasTirumalasetty,Chih Chieh Chou, NarasimhaReddy, Paul Gratz,and\nAyman Abouelwafa. Reducing Minor Page Fault Overheads through Enhanced\nPage Walker. ACM Trans. Archit. Code Optim.\n[53] Konstantinos Kanellopoulos, Rahul Bera, Kosta Stojiljkovic, Nisa Bostanci, Can\nFirtina, Rachata Ausavarungnirun, Rakesh Kumar, Nastaran Hajinazar, Jisung Park, Mohammad Sadrosadati, Nandita Vijaykumar, and Onur Mutlu. Utopia: Efficient Address Translation using Hybrid Virtual-to-Physical Address Mapping. arXiv:2211.12205 [cs.AR]\n[54] Konstantinos Kanellopoulos, Hong Chul Nam, F. Nisa Bostanci, Rahul Bera, Mohammad Sadrosadati, Rakesh Kumar, Davide Basilio Bartolini, and Onur Mutlu.\nVictima: Drastically Increasing Address Translation Reach by Leveraging Underutilized Cache Resources. In MICRO.\n[55] Jovan Stojkovic, Namrata Mantri, Dimitrios Skarlatos, Tianyin Xu, and Josep\nTorrellas.\nMemory-Efficient Hashed Page Tables. In 2023 IEEE International\nSymposium on High-Performance Computer Architecture (HPCA). 1221\u20131235.\nhttps://doi.org/10.1109/HPCA56546.2023.10071061\n[56] Kaiyang Zhao, Kaiwen Xue, Ziqi Wang, Dan Schatzberg, Leon Yang, Antonis\nManousis, Johannes Weiner, Rik Van Riel, Bikash Sharma, Chunqiang Tang, and Dimitrios Skarlatos. Contiguitas: the Pursuit of Physical Memory Contiguity in\nDatacenters. In ISCA."
    }
]